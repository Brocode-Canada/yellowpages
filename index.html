<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brocode PBC - Business Directory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="brocode_logo.png">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap & DataTables CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.bootstrap5.min.css" rel="stylesheet">

  <!-- Animate.css for animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

  <style>
    :root {
      --primary-red: #d70620;
      --primary-dark: #232526;
      --primary-light: #ffffff;
      --accent-color: #f8f8f8;
      --border-color: #b0b0b0;
      --transition-speed: 0.3s;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--primary-light);
      color: #000000;
      padding: 20px;
      transition: background-color var(--transition-speed) ease;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 30px;
      color: var(--primary-red);
      font-weight: 600;
    }

    .title-main {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 0;
      letter-spacing: -0.5px;
    }

    .title-sub {
      font-size: 1.8rem;
      font-weight: 600;
      color: #333;
      margin-top: 5px;
      letter-spacing: 1px;
    }

    .btn-red {
      background-color: var(--primary-red);
      color: var(--primary-light);
      border-radius: 8px;
      transition: all var(--transition-speed) ease;
      position: relative;
      overflow: hidden;
    }

    .btn-red:hover {
      background-color: #a00518;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(215, 6, 32, 0.3);
    }

    .btn-red:active {
      transform: translateY(0);
    }

    table.dataTable {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
      transition: all var(--transition-speed) ease;
    }

    .table {
      border: 2px solid var(--border-color);
      transition: all var(--transition-speed) ease;
    }

    .table thead {
      background-color: var(--primary-red);
      color: var(--primary-light);
    }

    .table thead th {
      border-bottom: 2px solid var(--border-color);
      border-right: 1px solid var(--border-color);
      transition: all var(--transition-speed) ease;
    }

    .table thead th:last-child {
      border-right: none;
    }

    .table tbody td {
      border: 1px solid var(--border-color);
      transition: all var(--transition-speed) ease;
    }

    .table tbody tr {
      transition: all 0.2s ease;
    }

    .table tbody tr:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .table tbody tr:last-child td {
      border-bottom: 2px solid var(--border-color);
    }

    .table tbody td:last-child {
      border-right: 2px solid var(--border-color);
    }

    .table tbody td:first-child {
      border-left: 2px solid var(--border-color);
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
      border-radius: 6px;
      transition: all var(--transition-speed) ease;
    }

    /* Search and Pagination Styling */
    .dataTables_wrapper .dataTables_filter input {
      border: 2px solid var(--border-color);
      border-radius: 6px;
      padding: 6px 12px;
      background-color: var(--accent-color);
      transition: all var(--transition-speed) ease;
    }

    .dataTables_wrapper .dataTables_filter input:focus {
      border-color: var(--primary-red);
      outline: none;
      box-shadow: 0 0 0 2px rgba(215, 6, 32, 0.1);
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
      color: #666 !important;
      border: 1px solid var(--border-color) !important;
      background: var(--accent-color) !important;
      margin: 0 2px;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      color: #fff !important;
      background: var(--primary-red) !important;
      border-color: var(--primary-red) !important;
      transform: translateY(-1px);
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      color: #fff !important;
      background: var(--primary-red) !important;
      border-color: var(--primary-red) !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.disabled {
      color: #999 !important;
      background: var(--accent-color) !important;
      border-color: var(--border-color) !important;
    }

    .dataTables_wrapper .dataTables_info {
      color: #666;
      padding-top: 12px;
    }

    .submit-btn {
      text-align: center;
      margin-top: 35px;
    }

    .disclaimer {
      margin-top: 50px;
      background-color: #fff3f3;
      border-left: 5px solid var(--primary-red);
      padding: 15px;
      font-size: 0.95rem;
      border-radius: 6px;
      transition: all var(--transition-speed) ease;
    }

    /* Enhanced mobile view styles */
    @media screen and (max-width: 767px) {
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        float: none;
        text-align: center;
        width: 100%;
      }
      
      .dataTables_wrapper .dataTables_paginate {
        margin-top: 10px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 4px;
      }
      
      .dataTables_wrapper .dataTables_paginate .paginate_button {
        margin: 0;
        padding: 5px 10px;
        font-size: 0.85rem;
      }
      
      /* Make table more readable on mobile */
      .table {
        font-size: 0.9rem;
      }
      
      .table td, .table th {
        padding: 0.5rem;
      }
      
      /* Ensure table is scrollable horizontally */
      .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      /* Make website links more visible */
      .table a {
        color: var(--primary-red);
        text-decoration: underline;
      }
      
      /* Adjust container padding for mobile */
      .container {
        padding-left: 10px;
        padding-right: 10px;
      }

      /* Mobile disclaimer styling */
      .disclaimer {
        font-size: 0.85rem;
        padding: 10px;
        margin-top: 30px;
      }

      .header-flex {
        flex-direction: column;
        gap: 10px;
      }
      .header-logo {
        margin-bottom: 8px;
      }
      
      /* Center filter controls on mobile */
      #filters-row {
        flex-direction: column !important;
        align-items: center !important;
        text-align: center;
      }
      
      #filters-controls {
        flex-direction: column !important;
        align-items: center !important;
        gap: 8px !important;
        margin-bottom: 8px;
        margin-top: 40px !important;
        width: 100%;
      }
      
      #custom-search-bar {
        justify-content: center !important;
        margin-bottom: 8px;
        width: 100%;
      }
      
      /* Match search bar input border to dropdowns */
      #custom-search-bar input[type="search"] {
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 6px 12px;
        background-color: var(--accent-color);
        width: 100%;
        max-width: 300px;
        box-sizing: border-box;
      }
      
      /* Center form selects */
      #filters-controls .form-select {
        width: 100%;
        max-width: 300px;
      }
      
      .title-main {
        font-size: 2rem;
      }
      .title-sub {
        font-size: 1.1rem;
      }
      
      /* Equal vertical spacing for filter controls and theme toggle */
      .container > .position-absolute,
      #filters-controls,
      #custom-search-bar {
        margin-bottom: 16px !important;
      }
      #filters-row {
        gap: 0 !important;
      }
      
      /* Mobile-specific table styles */
      #directory_wrapper {
        overflow-x: hidden;
        width: 100%;
      }
      
      #directory {
        width: 100% !important;
      }
      
      /* Hide table header completely on mobile */
      #directory thead {
        display: none !important;
      }
      
      #directory tbody tr {
        display: block;
        margin-bottom: 12px;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        background: var(--primary-light);
        width: 100%;
        box-sizing: border-box;
      }
      
      #directory tbody tr:after {
        content: "Tap for details";
        position: absolute;
        top: 0;
        right: 0;
        background: var(--primary-red);
        color: white;
        font-size: 0.7rem;
        padding: 3px 8px;
        border-bottom-left-radius: 8px;
        animation: pulseMobile 2s infinite;
      }
      
      /* Hide all table cells by default on mobile */
      #directory tbody tr td {
        display: none;
        border: none;
        padding: 0;
      }
      
      /* Show only the first three columns on mobile */
      #directory tbody tr td:nth-child(1),
      #directory tbody tr td:nth-child(2),
      #directory tbody tr td:nth-child(3) {
        display: block;
        padding: 4px 0;
        text-align: left;
        width: 100%;
        box-sizing: border-box;
      }
      
      /* Company name styling */
      #directory tbody tr td:nth-child(2) {
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--primary-red);
        margin-bottom: 4px;
      }
      
      /* Category and city styling */
      #directory tbody tr td:nth-child(1),
      #directory tbody tr td:nth-child(3) {
        font-size: 0.9rem;
        color: #666;
      }
      
      /* Mobile stats positioning */
      .stats-container {
        margin-top: 50px;
      }
      
      /* Mobile theme toggle positioning */
      .theme-toggle-mobile {
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 10;
      }
      
      .theme-toggle-desktop {
        display: none;
      }
      
      /* Mobile instruction banner */
      .mobile-instruction {
        display: block;
        background: var(--primary-red);
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        text-align: center;
        font-weight: 500;
        animation: pulse 2s infinite;
        width: 100%;
        box-sizing: border-box;
      }
      
      /* Ensure pagination fits within mobile width */
      .dataTables_wrapper .dataTables_paginate {
        max-width: 100%;
        overflow-x: auto;
      }
      
      /* Center filter tags */
      .filter-tags {
        justify-content: center;
      }
    }

    /* Desktop styles */
    @media screen and (min-width: 768px) {
      .theme-toggle-mobile {
        display: none;
      }
      
      .theme-toggle-desktop {
        display: block;
      }
      
      .mobile-instruction {
        display: none;
      }
    }

    .header-flex {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .header-logo {
      height: 64px;
      width: 64px;
      object-fit: contain;
      background: transparent;
      transition: transform 0.5s ease;
    }

    .header-logo:hover {
      transform: rotate(10deg) scale(1.05);
    }

    /* Dark Theme Styles */
    .dark-theme {
      background: linear-gradient(135deg, var(--primary-dark) 0%, #414345 100%) !important;
      color: #f1f1f1 !important;
    }
    .dark-theme .container {
      background: var(--primary-dark) !important;
      color: #f1f1f1 !important;
      box-shadow: 0 4px 32px 0 rgba(0,0,0,0.25);
    }
    .dark-theme h1, .dark-theme .title-main, .dark-theme .title-sub {
      color: unset !important;
    }
    .dark-theme .btn-red {
      background-color: #333 !important;
      color: #fff !important;
      border: 1px solid var(--primary-red);
    }
    .dark-theme .btn-red:hover {
      background-color: var(--primary-red) !important;
      color: #fff !important;
    }
    .dark-theme .table {
      background: var(--primary-dark) !important;
      color: #f1f1f1 !important;
      border-color: #444 !important;
    }
    .dark-theme .table thead {
      background-color: #18191a !important;
      color: #fff !important;
    }
    .dark-theme .table th, .dark-theme .table td {
      border-color: #444 !important;
      background: var(--primary-dark) !important;
      color: #f1f1f1 !important;
    }
    .dark-theme .table-striped > tbody > tr:nth-of-type(odd) {
      background-color: #2c2f34 !important;
    }
    .dark-theme .table-striped > tbody > tr:nth-of-type(even) {
      background-color: var(--primary-dark) !important;
    }
    .dark-theme .table-hover > tbody > tr:hover {
      background-color: #333 !important;
      color: #fff !important;
    }
    .dark-theme .form-select, .dark-theme input[type="search"] {
      background: var(--primary-dark) !important;
      color: #f1f1f1 !important;
      border: 1px solid #444 !important;
    }
    .dark-theme .form-select:focus, .dark-theme input[type="search"]:focus {
      border-color: var(--primary-red) !important;
      box-shadow: 0 0 0 2px rgba(215, 6, 32, 0.2) !important;
    }
    .dark-theme .dataTables_wrapper .dataTables_paginate .paginate_button {
      background: var(--primary-dark) !important;
      color: #f1f1f1 !important;
      border: 1px solid #444 !important;
    }
    .dark-theme .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dark-theme .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      background: var(--primary-red) !important;
      color: #fff !important;
      border-color: var(--primary-red) !important;
    }
    .dark-theme .dataTables_wrapper .dataTables_info {
      color: #ccc !important;
    }
    .dark-theme .disclaimer {
      background: var(--primary-dark) !important;
      color: #f1f1f1 !important;
      border-left: 5px solid var(--primary-red) !important;
    }
    .dark-theme a, .dark-theme .table a {
      color: var(--primary-red) !important;
    }
    .dark-theme .header-logo {
      filter: none !important;
    }

    /* Slider Switch Styles */
    .theme-switch {
      user-select: none;
    }
    .theme-switch .slider {
      position: relative;
      width: 44px;
      height: 24px;
      background: #ccc;
      border-radius: 24px;
      transition: background 0.3s;
      display: inline-block;
    }
    .theme-switch .slider:before {
      content: '';
      position: absolute;
      left: 3px;
      top: 3px;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.3s;
      box-shadow: 0 1px 4px rgba(0,0,0,0.15);
    }
    .theme-switch input:checked + .slider {
      background: var(--primary-red);
    }
    .theme-switch input:checked + .slider:before {
      transform: translateX(20px);
      background: #fff;
    }
    .theme-switch .slider {
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .dark-theme input[type="search"]::placeholder {
      color: #ccc !important;
      opacity: 1;
    }

    /* Mobile Company Modal Styles */
    @media screen and (max-width: 767px) {
      .company-modal-overlay {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0; top: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.3s ease;
      }
      .company-modal {
        background: #fff;
        border-radius: 12px;
        max-width: 90vw;
        width: 100%;
        padding: 24px 16px 16px 16px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        position: relative;
        box-sizing: border-box;
        overflow-x: hidden;
        word-break: break-word;
        animation: slideUp 0.3s ease;
      }
      .company-modal .close-btn {
        position: absolute;
        top: 8px;
        right: 12px;
        font-size: 1.5rem;
        color: var(--primary-red);
        background: none;
        border: none;
        cursor: pointer;
        transition: transform 0.2s ease;
      }
      .company-modal .close-btn:hover {
        transform: scale(1.1);
      }
      .company-modal h2 {
        font-size: 1.2rem;
        margin-bottom: 12px;
        color: var(--primary-red);
      }
      .company-modal ul {
        list-style: none;
        padding: 0;
        margin: 0;
        max-width: 100%;
        box-sizing: border-box;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      .company-modal ul li {
        margin-bottom: 8px;
        font-size: 1rem;
        max-width: 100%;
        box-sizing: border-box;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      .company-modal ul li span {
        font-weight: 600;
        color: #333;
        min-width: 90px;
        display: inline-block;
        max-width: 100%;
        box-sizing: border-box;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      
      /* Make website links in modal open in new tab */
      .company-modal a {
        color: var(--primary-red);
        text-decoration: underline;
      }
    }

    /* Dark mode for modal */
    .dark-theme .company-modal {
      background: var(--primary-dark);
      color: #f1f1f1;
    }
    .dark-theme .company-modal h2 {
      color: var(--primary-red);
    }
    .dark-theme .company-modal .close-btn {
      color: var(--primary-red);
    }
    .dark-theme .company-modal ul li span {
      color: #f1f1f1;
    }

    /* Force red theme for pagination buttons */
    .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:focus,
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:active,
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover,
    .dataTables_wrapper .dataTables_paginate .paginate_button:focus,
    .dataTables_wrapper .dataTables_paginate .paginate_button:active {
      background-color: var(--primary-red) !important;
      color: #fff !important;
      border-color: var(--primary-red) !important;
      box-shadow: none !important;
    }

    /* Animation keyframes */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes pulseMobile {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }

    /* Loading animation */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    .dark-theme .loading-overlay {
      background: rgba(35, 37, 38, 0.9);
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid var(--primary-red);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Stats counter */
    .stats-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .stat-box {
      background: var(--accent-color);
      border-radius: 10px;
      padding: 15px 20px;
      text-align: center;
      min-width: 120px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
    }

    .stat-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-red);
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #666;
    }

    .dark-theme .stat-box {
      background: #2c2f34;
    }

    .dark-theme .stat-label {
      color: #ccc;
    }

    /* Filter tags */
    .filter-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
      justify-content: center;
    }

    .filter-tag {
      background: var(--accent-color);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 5px 12px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter-tag:hover {
      background: var(--primary-red);
      color: white;
      border-color: var(--primary-red);
    }

    .filter-tag.active {
      background: var(--primary-red);
      color: white;
      border-color: var(--primary-red);
    }

    .dark-theme .filter-tag {
      background: #2c2f34;
      border-color: #444;
      color: #f1f1f1;
    }

    /* Row highlight animation */
    .highlight-row {
      animation: highlightPulse 2s ease;
    }

    @keyframes highlightPulse {
      0% { background-color: rgba(215, 6, 32, 0.2); }
      100% { background-color: transparent; }
    }

    /* Improved responsive design */
    @media (max-width: 576px) {
      .stats-container {
        gap: 10px;
      }
      
      .stat-box {
        min-width: 100px;
        padding: 10px 15px;
      }
      
      .stat-number {
        font-size: 1.5rem;
      }
    }
    
    /* Mobile instruction banner */
    .mobile-instruction {
      display: none;
    }
    
    /* Override default DataTables blue colors */
    .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
      background: var(--primary-red) !important;
      border-color: var(--primary-red) !important;
      color: white !important;
    }
    
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      background: var(--primary-red) !important;
      border-color: var(--primary-red) !important;
      color: white !important;
    }
  </style>
</head>
<body>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <div class="header-flex">
    <img src="brocode_logo.png" alt="Brocode Logo" class="header-logo" />
    <h1 style="margin-bottom:0;">
      <div class="title-main">Brocode - PBC</div>
      <div class="title-sub">Business Directory</div>
    </h1>
  </div>

  <div class="container position-relative animate__animated animate__fadeIn" style="max-width: 1100px; margin: 0 auto; background: #fff; box-shadow: 0 4px 32px 0 rgba(0,0,0,0.07); border-radius: 18px; padding: 32px 18px;">
    <!-- Dark Mode Toggle Slider - Desktop -->
    <div class="position-absolute theme-toggle-desktop" style="top: 18px; right: 18px; z-index: 10;">
      <label class="theme-switch d-flex align-items-center" style="cursor:pointer;">
        <input type="checkbox" id="theme-toggle-desktop" style="display:none;">
        <span class="slider"></span>
        <span class="ms-2" id="theme-label-desktop">Dark Mode</span>
      </label>
    </div>
    
    <!-- Dark Mode Toggle Slider - Mobile -->
    <div class="theme-toggle-mobile">
      <label class="theme-switch d-flex align-items-center" style="cursor:pointer;">
        <input type="checkbox" id="theme-toggle-mobile" style="display:none;">
        <span class="slider"></span>
        <span class="ms-2" id="theme-label-mobile">Dark</span>
      </label>
    </div>

    <!-- Stats Counter -->
    <div class="stats-container" id="statsContainer">
      <div class="stat-box">
        <div class="stat-number" id="totalBusinesses">0</div>
        <div class="stat-label">Total Businesses</div>
      </div>
      <div class="stat-box">
        <div class="stat-number" id="totalCategories">0</div>
        <div class="stat-label">Categories</div>
      </div>
      <div class="stat-box">
        <div class="stat-number" id="totalCities">0</div>
        <div class="stat-label">Cities</div>
      </div>
    </div>

    <!-- Mobile Instruction Banner -->
    <div class="mobile-instruction" id="mobileInstruction">
      ðŸ‘† Tap on any business card to view full details
    </div>

    <!-- Quick Filter Tags -->
    <div class="filter-tags" id="quickFilters"></div>

    <!-- Filters Row -->
    <div class="d-flex flex-wrap align-items-center justify-content-between mb-3 w-100 flex-row" id="filters-row">
      <div class="d-flex flex-wrap align-items-center gap-2 flex-row" id="filters-controls">
        <div id="directory_length"></div>
        <select id="categoryFilter" class="form-select" style="min-width: 140px;">
          <option value="">All Categories</option>
        </select>
        <select id="cityFilter" class="form-select" style="min-width: 120px;">
          <option value="">All Cities</option>
        </select>
      </div>
      <div id="custom-search-bar" class="d-flex align-items-center gap-2"></div>
    </div>
    <div class="table-responsive">
      <table id="directory" class="table table-hover table-bordered table-striped nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Category</th>
            <th>Company</th>
            <th>City</th>
            <th>Phone</th>
            <th>Name</th>
            <th>Website</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Submit Business Button -->
    <div class="submit-btn">
      <a href="https://forms.gle/yxRXCJjukyJTKKGa9" target="_blank" class="btn btn-red btn-lg shadow-sm animate__animated animate__pulse animate__infinite" style="animation-duration: 2s;">ðŸ“¬ Submit Your Business</a>
    </div>

    <!-- Disclaimer -->
    <div class="disclaimer mt-4">
      <strong>Disclaimer:</strong> <br>Brocode - PBC is not responsible for the actions or representations of listed businesses. Users should exercise their own discretion when interacting with featured businesses.
    </div>
  </div>

  <!-- Company Details Modal (Mobile Only) -->
  <div class="company-modal-overlay" id="companyModalOverlay">
    <div class="company-modal">
      <button class="close-btn" id="closeCompanyModal">&times;</button>
      <h2 id="modalCompanyName"></h2>
      <ul id="modalCompanyDetails"></ul>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.4.1/js/responsive.bootstrap5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <script>
    $(document).ready(function () {
      const csvUrl = 'https://raw.githubusercontent.com/Brocode-Canada/yellowpages/main/directory.csv';
      let tableData = [];
      
      // Show loading overlay
      $('#loadingOverlay').show();
      
      const table = $('#directory').DataTable({
        dom: 'rtip',
        responsive: {
          details: false,
          breakpoints: [
            { name: 'desktop', width: Infinity },
            { name: 'tablet', width: 1024 },
            { name: 'phone', width: 480 }
          ]
        },
        pageLength: 25,
        language: {
          responsive: {
            details: {
              display: $.fn.dataTable.Responsive.display.childRowImmediate
            }
          }
        },
        columnDefs: [
          {
            targets: '_all',
            render: function(data, type, row) {
              if (data === null || data === '' || data === undefined) {
                return '-';
              }
              return data;
            }
          },
          {
            targets: 0, // Category
            width: '15%'
          },
          {
            targets: 1, // Company
            width: '20%'
          },
          {
            targets: 2, // City
            width: '15%'
          },
          {
            targets: 3, // Phone
            width: '15%',
            type: 'string'
          },
          {
            targets: 4, // Name
            width: '20%'
          },
          {
            targets: 5, // Website
            width: '15%',
            render: function(data, type, row) {
              if (type === 'display') {
                if (!data || data === '') {
                  return '-';
                }
                let url = data;
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                  url = 'https://' + url;
                }
                // Make website links open in new tab
                return '<a href="' + url + '" target="_blank" rel="noopener noreferrer">' + data + '</a>';
              }
              return data;
            }
          }
        ],
        autoWidth: false,
        scrollX: true,
        initComplete: function() {
          // Hide loading overlay when table is ready
          setTimeout(function() {
            $('#loadingOverlay').fadeOut(500);
          }, 800);
          
          // Apply mobile table transformation
          transformTableForMobile();
        },
        drawCallback: function() {
          // Re-apply mobile table transformation after each draw
          transformTableForMobile();
        }
      });

      // Function to transform table for mobile view
      function transformTableForMobile() {
        if (window.matchMedia('(max-width: 767px)').matches) {
          // Add click event to entire row on mobile
          $('#directory tbody tr').off('click').on('click', function() {
            const rowIdx = table.row(this).index();
            const rowData = table.row(rowIdx).data();
            showCompanyModal(rowData);
          });
          
          // Add hover effect for better UX
          $('#directory tbody tr').css('cursor', 'pointer');
        }
      }

      // Populate filters and table
      Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: function (results) {
          const categories = new Set();
          const cities = new Set();
          let businessCount = 0;
          
          results.data.forEach(row => {
            if (row.Name) {
              businessCount++;
              if (row.Category) categories.add(row.Category);
              if (row.City) cities.add(row.City);
              table.row.add([
                row.Category,
                row.Company,
                row.City,
                row.Phone,
                row.Name,
                row.Website ? row.Website : ''
              ]).draw(false);
              tableData.push(row);
            }
          });
          
          // Update stats with animation
          animateCounter('totalBusinesses', businessCount);
          animateCounter('totalCategories', categories.size);
          animateCounter('totalCities', cities.size);
          
          // Populate Category filter
          Array.from(categories).sort().forEach(cat => {
            $('#categoryFilter').append(`<option value="${cat}">${cat}</option>`);
          });
          
          // Populate City filter
          Array.from(cities).sort().forEach(city => {
            $('#cityFilter').append(`<option value="${city}">${city}</option>`);
          });
          
          // Create quick filter tags for top categories
          const categoryCounts = {};
          tableData.forEach(row => {
            if (row.Category) {
              categoryCounts[row.Category] = (categoryCounts[row.Category] || 0) + 1;
            }
          });
          
          // Get top 5 categories by count
          const topCategories = Object.entries(categoryCounts)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5)
            .map(entry => entry[0]);
          
          // Add quick filter tags
          topCategories.forEach(cat => {
            $('#quickFilters').append(`<div class="filter-tag" data-category="${cat}">${cat}</div>`);
          });
          
          // Add event listeners to quick filter tags
          $('.filter-tag').on('click', function() {
            const category = $(this).data('category');
            $('.filter-tag').removeClass('active');
            $(this).addClass('active');
            $('#categoryFilter').val(category).trigger('change');
          });
        }
      });

      // Filter logic
      $('#categoryFilter').on('change', function() {
        const val = $(this).val();
        table.column(0).search(val ? '^' + $.fn.dataTable.util.escapeRegex(val) + '$' : '', true, false).draw();
        
        // Update quick filter tags
        if (val) {
          $('.filter-tag').removeClass('active');
          $(`.filter-tag[data-category="${val}"]`).addClass('active');
        } else {
          $('.filter-tag').removeClass('active');
        }
      });
      
      $('#cityFilter').on('change', function() {
        const val = $(this).val();
        table.column(2).search(val ? '^' + $.fn.dataTable.util.escapeRegex(val) + '$' : '', true, false).draw();
      });

      // Move DataTables search and length controls into custom filter row
      $('#custom-search-bar').empty();
      var searchInput = $('#directory_filter input');
      if (searchInput.length === 0) {
        searchInput = $('<input type="search" id="directory_search_input" class="form-control" placeholder="Search...">');
        $('#custom-search-bar').append(searchInput);
        searchInput.on('input', function() {
          table.search(this.value).draw();
        });
      } else {
        $('#directory_filter label').contents().filter(function(){ return this.nodeType === 3; }).remove();
        searchInput.attr('id', 'directory_search_input');
        searchInput.attr('placeholder', 'Search...');
        $('#custom-search-bar').append(searchInput);
      }
      searchInput.css({display: 'block', width: 'auto', minWidth: '120px'});

      // Dark mode toggle logic
      function setTheme(dark) {
        if (dark) {
          $('body').addClass('dark-theme');
          $('#theme-toggle-desktop').prop('checked', true);
          $('#theme-toggle-mobile').prop('checked', true);
          $('#theme-label-desktop').text('Light Mode');
          $('#theme-label-mobile').text('Light');
          localStorage.setItem('theme', 'dark');
        } else {
          $('body').removeClass('dark-theme');
          $('#theme-toggle-desktop').prop('checked', false);
          $('#theme-toggle-mobile').prop('checked', false);
          $('#theme-label-desktop').text('Dark Mode');
          $('#theme-label-mobile').text('Dark');
          localStorage.setItem('theme', 'light');
        }
      }
      
      // On load, set theme from localStorage
      setTheme(localStorage.getItem('theme') === 'dark');
      $('#theme-toggle-desktop, #theme-toggle-mobile').on('change', function() {
        setTheme(this.checked);
      });

      // Mobile company modal logic
      function isMobile() {
        return window.matchMedia('(max-width: 767px)').matches;
      }
      
      function showCompanyModal(data) {
        $('#modalCompanyName').text(data[1] || '-');
        const details = [
          { label: 'Category', value: data[0] },
          { label: 'Company', value: data[1] },
          { label: 'City', value: data[2] },
          { label: 'Phone', value: data[3] },
          { label: 'BroCode Contact Person', value: data[4] },
          { label: 'Website', value: data[5] }
        ];
        
        // Create website link that opens in new tab
        let websiteValue = data[5] || '-';
        if (websiteValue !== '-' && websiteValue !== '') {
          let url = websiteValue;
          if (!url.startsWith('http://') && !url.startsWith('https://')) {
            url = 'https://' + url;
          }
          websiteValue = '<a href="' + url + '" target="_blank" rel="noopener noreferrer">' + data[5] + '</a>';
        }
        
        $('#modalCompanyDetails').html(`
          <li><span>Category:</span> ${data[0] || '-'}</li>
          <li><span>Company:</span> ${data[1] || '-'}</li>
          <li><span>City:</span> ${data[2] || '-'}</li>
          <li><span>Phone:</span> ${data[3] || '-'}</li>
          <li><span>BroCode Contact Person:</span> ${data[4] || '-'}</li>
          <li><span>Website:</span> ${websiteValue}</li>
        `);
        $('#companyModalOverlay').css('display', 'flex');
      }
      
      function hideCompanyModal() {
        $('#companyModalOverlay').css('display', 'none');
      }
      
      $('#closeCompanyModal').on('click', hideCompanyModal);
      $('#companyModalOverlay').on('click', function(e) {
        if (e.target === this) hideCompanyModal();
      });
      
      // Animate counter function
      function animateCounter(elementId, targetValue) {
        const element = document.getElementById(elementId);
        let currentValue = 0;
        const increment = targetValue / 50; // Adjust speed by changing divisor
        const timer = setInterval(() => {
          currentValue += increment;
          if (currentValue >= targetValue) {
            clearInterval(timer);
            currentValue = targetValue;
          }
          element.textContent = Math.floor(currentValue);
        }, 30);
      }
      
      // Add highlight animation to new rows
      table.on('draw', function() {
        $('tbody tr').each(function() {
          $(this).addClass('highlight-row');
          setTimeout(() => {
            $(this).removeClass('highlight-row');
          }, 2000);
        });
      });
      
      // Handle window resize
      $(window).on('resize', function() {
        transformTableForMobile();
      });
    });
  </script>
</body>
</html>
