<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brocode PBC - Business Directory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="brocode_logo.png">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <!-- Bootstrap & DataTables CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.bootstrap5.min.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #ffffff;
      color: #000000;
      padding: 20px;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 30px;
      color: #d70620;
      font-weight: 600;
    }

    .title-main {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 0;
      letter-spacing: -0.5px;
    }

    .title-sub {
      font-size: 1.8rem;
      font-weight: 600;
      color: #333;
      margin-top: 5px;
      letter-spacing: 1px;
    }

    .btn-red {
      background-color: #d70620;
      color: #ffffff;
      border-radius: 8px;
    }

    .btn-red:hover {
      background-color: #a00518;
    }

    table.dataTable {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
    }

    .table {
      border: 2px solid #b0b0b0;
    }

    .table thead {
      background-color: #d70620;
      color: #ffffff;
    }

    .table thead th {
      border-bottom: 2px solid #b0b0b0;
      border-right: 1px solid #b0b0b0;
    }

    .table thead th:last-child {
      border-right: none;
    }

    .table tbody td {
      border: 1px solid #b0b0b0;
    }

    .table tbody tr:last-child td {
      border-bottom: 2px solid #b0b0b0;
    }

    .table tbody td:last-child {
      border-right: 2px solid #b0b0b0;
    }

    .table tbody td:first-child {
      border-left: 2px solid #b0b0b0;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
      border-radius: 6px;
    }

    /* Search and Pagination Styling */
    .dataTables_wrapper .dataTables_filter input {
      border: 2px solid #b0b0b0;
      border-radius: 6px;
      padding: 6px 12px;
      background-color: #f8f8f8;
    }

    .dataTables_wrapper .dataTables_filter input:focus {
      border-color: #d70620;
      outline: none;
      box-shadow: 0 0 0 2px rgba(215, 6, 32, 0.1);
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
      color: #666 !important;
      border: 1px solid #b0b0b0 !important;
      background: #f8f8f8 !important;
      margin: 0 2px;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      color: #fff !important;
      background: #d70620 !important;
      border-color: #d70620 !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      color: #fff !important;
      background: #d70620 !important;
      border-color: #d70620 !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.disabled {
      color: #999 !important;
      background: #f8f8f8 !important;
      border-color: #b0b0b0 !important;
    }

    .dataTables_wrapper .dataTables_info {
      color: #666;
      padding-top: 12px;
    }

    .submit-btn {
      text-align: center;
      margin-top: 35px;
    }

    .disclaimer {
      margin-top: 50px;
      background-color: #fff3f3;
      border-left: 5px solid #d70620;
      padding: 15px;
      font-size: 0.95rem;
      border-radius: 6px;
    }

    /* Enhanced mobile view styles */
    @media screen and (max-width: 767px) {
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        float: none;
        text-align: center;
      }
      
      .dataTables_wrapper .dataTables_paginate {
        margin-top: 10px;
      }
      
      /* Make table more readable on mobile */
      .table {
        font-size: 0.9rem;
      }
      
      .table td, .table th {
        padding: 0.5rem;
      }
      
      /* Ensure table is scrollable horizontally */
      .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      /* Make website links more visible */
      .table a {
        color: #d70620;
        text-decoration: underline;
      }
      
      /* Adjust container padding for mobile */
      .container {
        padding-left: 10px;
        padding-right: 10px;
      }

      /* Mobile disclaimer styling */
      .disclaimer {
        font-size: 0.85rem;
        padding: 10px;
        margin-top: 30px;
      }

      .header-flex {
        flex-direction: column;
        gap: 10px;
      }
      .header-logo {
        margin-bottom: 8px;
      }
      /* Stack filter controls vertically on mobile */
      #filters-row {
        flex-direction: column !important;
        align-items: stretch !important;
      }
      #filters-controls {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 8px !important;
        margin-bottom: 8px;
        margin-top: 40px !important;
      }
      #custom-search-bar {
        justify-content: flex-start !important;
        margin-bottom: 8px;
      }
      /* Match search bar input border to dropdowns */
      #custom-search-bar input[type="search"] {
        border: 1px solid #b0b0b0;
        border-radius: 6px;
        padding: 6px 12px;
        background-color: #f8f8f8;
        width: 100%;
        box-sizing: border-box;
      }
      .title-main {
        font-size: 2rem;
      }
      .title-sub {
        font-size: 1.1rem;
      }
      /* Equal vertical spacing for filter controls and theme toggle */
      .container > .position-absolute,
      #filters-controls,
      #custom-search-bar {
        margin-bottom: 16px !important;
      }
      #filters-row {
        gap: 0 !important;
      }
    }

    .header-flex {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .header-logo {
      height: 64px;
      width: 64px;
      object-fit: contain;
      background: transparent;
    }

    /* Dark Theme Styles */
    .dark-theme {
      background: linear-gradient(135deg, #232526 0%, #414345 100%) !important;
      color: #f1f1f1 !important;
    }
    .dark-theme .container {
      background: #232526 !important;
      color: #f1f1f1 !important;
      box-shadow: 0 4px 32px 0 rgba(0,0,0,0.25);
    }
    .dark-theme h1, .dark-theme .title-main, .dark-theme .title-sub {
      color: unset !important;
    }
    .dark-theme .btn-red {
      background-color: #333 !important;
      color: #fff !important;
      border: 1px solid #d70620;
    }
    .dark-theme .btn-red:hover {
      background-color: #d70620 !important;
      color: #fff !important;
    }
    .dark-theme .table {
      background: #232526 !important;
      color: #f1f1f1 !important;
      border-color: #444 !important;
    }
    .dark-theme .table thead {
      background-color: #18191a !important;
      color: #fff !important;
    }
    .dark-theme .table th, .dark-theme .table td {
      border-color: #444 !important;
      background: #232526 !important;
      color: #f1f1f1 !important;
    }
    .dark-theme .table-striped > tbody > tr:nth-of-type(odd) {
      background-color: #2c2f34 !important;
    }
    .dark-theme .table-striped > tbody > tr:nth-of-type(even) {
      background-color: #232526 !important;
    }
    .dark-theme .table-hover > tbody > tr:hover {
      background-color: #333 !important;
      color: #fff !important;
    }
    .dark-theme .form-select, .dark-theme input[type="search"] {
      background: #232526 !important;
      color: #f1f1f1 !important;
      border: 1px solid #444 !important;
    }
    .dark-theme .form-select:focus, .dark-theme input[type="search"]:focus {
      border-color: #d70620 !important;
      box-shadow: 0 0 0 2px rgba(215, 6, 32, 0.2) !important;
    }
    .dark-theme .dataTables_wrapper .dataTables_paginate .paginate_button {
      background: #232526 !important;
      color: #f1f1f1 !important;
      border: 1px solid #444 !important;
    }
    .dark-theme .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dark-theme .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      background: #d70620 !important;
      color: #fff !important;
      border-color: #d70620 !important;
    }
    .dark-theme .dataTables_wrapper .dataTables_info {
      color: #ccc !important;
    }
    .dark-theme .disclaimer {
      background: #232526 !important;
      color: #f1f1f1 !important;
      border-left: 5px solid #d70620 !important;
    }
    .dark-theme a, .dark-theme .table a {
      color: #d70620 !important;
    }
    .dark-theme .header-logo {
      filter: none !important;
    }

    /* Slider Switch Styles */
    .theme-switch {
      user-select: none;
    }
    .theme-switch .slider {
      position: relative;
      width: 44px;
      height: 24px;
      background: #ccc;
      border-radius: 24px;
      transition: background 0.3s;
      display: inline-block;
    }
    .theme-switch .slider:before {
      content: '';
      position: absolute;
      left: 3px;
      top: 3px;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.3s;
      box-shadow: 0 1px 4px rgba(0,0,0,0.15);
    }
    .theme-switch input:checked + .slider {
      background: #d70620;
    }
    .theme-switch input:checked + .slider:before {
      transform: translateX(20px);
      background: #fff;
    }
    .theme-switch .slider {
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .dark-theme input[type="search"]::placeholder {
      color: #ccc !important;
      opacity: 1;
    }

    /* Mobile Company Modal Styles */
    @media screen and (max-width: 767px) {
      .company-cell {
        cursor: pointer;
        color: #d70620;
        text-decoration: underline;
        transition: background 0.2s;
      }
      .company-cell:active, .company-cell:hover {
        background: #f8f8f8;
      }
      .company-modal-overlay {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0; top: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
      }
      .company-modal {
        background: #fff;
        border-radius: 12px;
        max-width: 90vw;
        width: 100%;
        padding: 24px 16px 16px 16px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        position: relative;
        box-sizing: border-box;
        overflow-x: hidden;
        word-break: break-word;
      }
      .company-modal .close-btn {
        position: absolute;
        top: 8px;
        right: 12px;
        font-size: 1.5rem;
        color: #d70620;
        background: none;
        border: none;
        cursor: pointer;
      }
      .company-modal h2 {
        font-size: 1.2rem;
        margin-bottom: 12px;
        color: #d70620;
      }
      .company-modal ul {
        list-style: none;
        padding: 0;
        margin: 0;
        max-width: 100%;
        box-sizing: border-box;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      .company-modal ul li {
        margin-bottom: 8px;
        font-size: 1rem;
        max-width: 100%;
        box-sizing: border-box;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      .company-modal ul li span {
        font-weight: 600;
        color: #333;
        min-width: 90px;
        display: inline-block;
        max-width: 100%;
        box-sizing: border-box;
        word-break: break-word;
        overflow-wrap: break-word;
      }
    }

    /* Dark mode for modal */
    .dark-theme .company-modal {
      background: #232526;
      color: #f1f1f1;
    }
    .dark-theme .company-modal h2 {
      color: #d70620;
    }
    .dark-theme .company-modal .close-btn {
      color: #d70620;
    }
    .dark-theme .company-modal ul li span {
      color: #f1f1f1;
    }

    /* Force red theme for pagination buttons */
    .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:focus,
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:active,
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover,
    .dataTables_wrapper .dataTables_paginate .paginate_button:focus,
    .dataTables_wrapper .dataTables_paginate .paginate_button:active {
      background-color: #d70620 !important;
      color: #fff !important;
      border-color: #d70620 !important;
      box-shadow: none !important;
    }
  </style>
</head>
<body>

  <div class="header-flex">
    <img src="brocode_logo.png" alt="Brocode Logo" class="header-logo" />
    <h1 style="margin-bottom:0;">
      <div class="title-main">Brocode - PBC</div>
      <div class="title-sub">Business Directory</div>
    </h1>
  </div>

  <div class="container position-relative" style="max-width: 1100px; margin: 0 auto; background: #fff; box-shadow: 0 4px 32px 0 rgba(0,0,0,0.07); border-radius: 18px; padding: 32px 18px;">
    <!-- Dark Mode Toggle Slider -->
    <div class="position-absolute" style="top: 18px; right: 18px; z-index: 10;">
      <label class="theme-switch d-flex align-items-center" style="cursor:pointer;">
        <input type="checkbox" id="theme-toggle" style="display:none;">
        <span class="slider"></span>
        <span class="ms-2" id="theme-label">Dark Mode</span>
      </label>
    </div>
    <!-- Filters Row -->
    <div class="d-flex flex-wrap align-items-center justify-content-between mb-3 w-100 flex-row" id="filters-row">
      <div class="d-flex flex-wrap align-items-center gap-2 flex-row" id="filters-controls">
        <div id="directory_length"></div>
        <select id="categoryFilter" class="form-select" style="min-width: 140px;">
          <option value="">All Categories</option>
        </select>
        <select id="cityFilter" class="form-select" style="min-width: 120px;">
          <option value="">All Cities</option>
        </select>
      </div>
      <div id="custom-search-bar" class="d-flex align-items-center gap-2"></div>
    </div>
    <div class="table-responsive">
      <table id="directory" class="table table-hover table-bordered table-striped nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Category</th>
            <th>Company</th>
            <th>City</th>
            <th>Phone</th>
            <th>Name</th>
            <th>Website</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Submit Business Button -->
    <div class="submit-btn">
      <a href="https://forms.gle/yxRXCJjukyJTKKGa9" target="_blank" class="btn btn-red btn-lg shadow-sm">📬 Submit Your Business</a>
    </div>

    <!-- Disclaimer -->
    <div class="disclaimer mt-4">
      <strong>Disclaimer:</strong> <br>Brocode - PBC is not responsible for the actions or representations of listed businesses. Users should exercise their own discretion when interacting with featured businesses.
    </div>
  </div>

  <!-- Company Details Modal (Mobile Only) -->
  <div class="company-modal-overlay" id="companyModalOverlay">
    <div class="company-modal">
      <button class="close-btn" id="closeCompanyModal">&times;</button>
      <h2 id="modalCompanyName"></h2>
      <ul id="modalCompanyDetails"></ul>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.4.1/js/responsive.bootstrap5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <script>
       $(document).ready(function () {
      const csvUrl = 'https://raw.githubusercontent.com/Brocode-Canada/yellowpages/main/directory.csv';
      const table = $('#directory').DataTable({
        dom: 'rtip', // Remove length control
        responsive: {
          details: false, // Disable the responsive details view
          breakpoints: [
            { name: 'desktop', width: Infinity },
            { name: 'tablet', width: 1024 },
            { name: 'phone', width: 480 }
          ]
        },
        pageLength: 25,
        language: {
          responsive: {
            details: {
              display: $.fn.dataTable.Responsive.display.childRowImmediate
            }
          }
        },
        columnDefs: [
          {
            targets: '_all', // Apply to all columns
            render: function(data, type, row) {
              if (data === null || data === '' || data === undefined) {
                return '-';
              }
              return data;
            }
          },
          {
            targets: 0, // Category
            width: '15%'
          },
          {
            targets: 1, // Company
            width: '20%'
          },
          {
            targets: 2, // City
            width: '15%'
          },
          {
            targets: 3, // Phone
            width: '15%',
            type: 'string'
          },
          {
            targets: 4, // Name
            width: '20%'
          },
          {
            targets: 5, // Website
            width: '15%',
            render: function(data, type, row) {
              if (type === 'display') {
                if (!data || data === '') {
                  return '-';
                }
                let url = data;
                // Add https:// if missing
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                  url = 'https://' + url;
                }
                return '<a href="' + url + '" target="_blank" rel="noopener">' + data + '</a>';
              }
              return data;
            }
          }
        ],
        autoWidth: false,
        scrollX: true
      });

      // Populate filters and table
      Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: function (results) {
          const categories = new Set();
          const cities = new Set();
          results.data.forEach(row => {
            if (row.Name) {
              // Collect unique categories and cities
              if (row.Category) categories.add(row.Category);
              if (row.City) cities.add(row.City);
              table.row.add([
                row.Category,
                row.Company,
                row.City,
                row.Phone,
                row.Name,
                row.Website ? row.Website : '' // Store raw URL
              ]).draw(false);
            }
          });
          // Populate Category filter
          Array.from(categories).sort().forEach(cat => {
            $('#categoryFilter').append(`<option value="${cat}">${cat}</option>`);
          });
          // Populate City filter
          Array.from(cities).sort().forEach(city => {
            $('#cityFilter').append(`<option value="${city}">${city}</option>`);
          });
        }
      });

      // Filter logic
      $('#categoryFilter').on('change', function() {
        const val = $(this).val();
        table.column(0).search(val ? '^' + $.fn.dataTable.util.escapeRegex(val) + '$' : '', true, false).draw();
      });
      $('#cityFilter').on('change', function() {
        const val = $(this).val();
        table.column(2).search(val ? '^' + $.fn.dataTable.util.escapeRegex(val) + '$' : '', true, false).draw();
      });

      // Move DataTables search and length controls into custom filter row
      $('#custom-search-bar').empty();
      // Move the DataTables search input into the custom search bar
      var searchInput = $('#directory_filter input');
      if (searchInput.length === 0) {
        // Fallback: create a new input if not found
        searchInput = $('<input type="search" id="directory_search_input" class="form-control" placeholder="Search...">');
        $('#custom-search-bar').append(searchInput);
        // Add event to filter table
        searchInput.on('input', function() {
          table.search(this.value).draw();
        });
      } else {
        $('#directory_filter label').contents().filter(function(){ return this.nodeType === 3; }).remove(); // Remove default label text
        searchInput.attr('id', 'directory_search_input');
        searchInput.attr('placeholder', 'Search...');
        $('#custom-search-bar').append(searchInput);
      }
      // Ensure the search input is visible
      searchInput.css({display: 'block', width: 'auto', minWidth: '120px'});

      // Dark mode toggle logic
      function setTheme(dark) {
        if (dark) {
          $('body').addClass('dark-theme');
          $('#theme-toggle').prop('checked', true);
          $('#theme-label').text('Light Mode');
          localStorage.setItem('theme', 'dark');
        } else {
          $('body').removeClass('dark-theme');
          $('#theme-toggle').prop('checked', false);
          $('#theme-label').text('Dark Mode');
          localStorage.setItem('theme', 'light');
        }
      }
      // On load, set theme from localStorage
      setTheme(localStorage.getItem('theme') === 'dark');
      $('#theme-toggle').on('change', function() {
        setTheme(this.checked);
      });

      // Mobile company modal logic
      function isMobile() {
        return window.matchMedia('(max-width: 767px)').matches;
      }
      function showCompanyModal(data) {
        $('#modalCompanyName').text(data[1] || '-');
        const details = [
          { label: 'Category', value: data[0] },
          { label: 'Company', value: data[1] },
          { label: 'City', value: data[2] },
          { label: 'Phone', value: data[3] },
          { label: 'Name', value: data[4] },
          { label: 'Website', value: data[5] }
        ];
        $('#modalCompanyDetails').html(details.map(d => `<li><span>${d.label}:</span> ${d.value || '-'}</li>`).join(''));
        $('#companyModalOverlay').css('display', 'flex');
      }
      function hideCompanyModal() {
        $('#companyModalOverlay').css('display', 'none');
      }
      $('#closeCompanyModal').on('click', hideCompanyModal);
      $('#companyModalOverlay').on('click', function(e) {
        if (e.target === this) hideCompanyModal();
      });
      // Add click event to company cells on mobile
      function addCompanyCellListeners() {
        if (isMobile()) {
          $('#directory tbody').off('click', '.company-cell').on('click', '.company-cell', function() {
            const rowIdx = table.row($(this).closest('tr')).index();
            const rowData = table.row(rowIdx).data();
            showCompanyModal(rowData);
          });
        } else {
          $('#directory tbody').off('click', '.company-cell');
        }
      }
      // On table draw, add .company-cell class to company column (index 1)
      table.on('draw', function() {
        if (isMobile()) {
          $('#directory tbody tr').each(function() {
            $(this).find('td').eq(1).addClass('company-cell');
          });
        } else {
          $('#directory tbody tr td.company-cell').removeClass('company-cell');
        }
        addCompanyCellListeners();
      });
      // On resize, re-apply listeners and classes
      $(window).on('resize', function() {
        table.rows().invalidate().draw(false);
      });
    });
  </script>
</body>
</html>
